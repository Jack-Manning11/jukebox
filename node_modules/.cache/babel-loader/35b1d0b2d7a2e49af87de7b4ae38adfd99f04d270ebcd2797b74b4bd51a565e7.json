{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jackmanning/Desktop/Railway-Jukebox/jukebox/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/jackmanning/Desktop/Railway-Jukebox/jukebox/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/jackmanning/Desktop/Railway-Jukebox/jukebox/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable no-undef */import{useState,useEffect}from'react';import axios from'axios';var useAuth=function useAuth(code){var _useState=useState(),_useState2=_slicedToArray(_useState,2),accessToken=_useState2[0],setAccessToken=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),refreshToken=_useState4[0],setRefreshToken=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),expiresIn=_useState6[0],setExpiresIn=_useState6[1];useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axios$post,_yield$axios$post$dat,access_token,refresh_token,expires_in;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.post(\"https://jukebox-backend-production-dd99.up.railway.app/login\",{code:code});case 3:_yield$axios$post=_context.sent;_yield$axios$post$dat=_yield$axios$post.data;access_token=_yield$axios$post$dat.access_token;refresh_token=_yield$axios$post$dat.refresh_token;expires_in=_yield$axios$post$dat.expires_in;setAccessToken(access_token);setRefreshToken(refresh_token);setExpiresIn(expires_in);window.history.pushState({},null,'/');_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.log(\"Error: \",_context.t0);//window.location = '/';\ncase 17:case\"end\":return _context.stop();}},_callee,null,[[0,14]]);}))();},[code]);useEffect(function(){if(!refreshToken||!expiresIn)return;var interval=setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _yield$axios$post2,_yield$axios$post2$da,access_token,expires_in;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.post(\"https://jukebox-backend-production-dd99.up.railway.app/refresh\",{refreshToken:refreshToken});case 3:_yield$axios$post2=_context2.sent;_yield$axios$post2$da=_yield$axios$post2.data;access_token=_yield$axios$post2$da.access_token;expires_in=_yield$axios$post2$da.expires_in;setAccessToken(access_token);setExpiresIn(expires_in);_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);window.location='/';case 14:case\"end\":return _context2.stop();}},_callee2,null,[[0,11]]);})),(expiresIn-60)*1000);return function(){return clearInterval(interval);};},[refreshToken,expiresIn]);return accessToken;};export default useAuth;","map":{"version":3,"names":["useState","useEffect","axios","useAuth","code","_useState","_useState2","_slicedToArray","accessToken","setAccessToken","_useState3","_useState4","refreshToken","setRefreshToken","_useState5","_useState6","expiresIn","setExpiresIn","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$axios$post","_yield$axios$post$dat","access_token","refresh_token","expires_in","wrap","_callee$","_context","prev","next","post","sent","data","window","history","pushState","t0","console","log","stop","interval","setInterval","_callee2","_yield$axios$post2","_yield$axios$post2$da","_callee2$","_context2","location","clearInterval"],"sources":["/Users/jackmanning/Desktop/Railway-Jukebox/jukebox/src/hooks/useAuth.jsx"],"sourcesContent":["/* eslint-disable no-undef */\nimport { useState, useEffect } from 'react';\nimport axios from 'axios';\n\nconst useAuth = (code) => {\n    const [accessToken, setAccessToken] = useState();\n    const [refreshToken, setRefreshToken] = useState();\n    const [expiresIn, setExpiresIn] = useState();\n\n    useEffect(() => {\n        (async () => {\n            try {\n                const {\n                    data: { access_token, refresh_token, expires_in },\n                } = await axios.post(\"https://jukebox-backend-production-dd99.up.railway.app/login\", {\n                    code,\n                });\n                setAccessToken(access_token);\n                setRefreshToken(refresh_token);\n                setExpiresIn(expires_in);\n                window.history.pushState({}, null, '/');\n            } catch (error){\n                console.log(\"Error: \", error);\n                //window.location = '/';\n            }\n        })();\n    }, [code]);\n\n    useEffect(() => {\n        if(!refreshToken || !expiresIn) return;\n        const interval = setInterval(async () => {\n            try {\n                const {\n                    data: { access_token, expires_in },\n                } = await axios.post(`https://jukebox-backend-production-dd99.up.railway.app/refresh`, {\n                    refreshToken,\n                });\n                setAccessToken(access_token);\n                setExpiresIn(expires_in);\n            } catch {\n                window.location = '/';\n            }\n        }, (expiresIn - 60) * 1000);\n\n        return () => clearInterval(interval);\n    }, [refreshToken, expiresIn]);\n\n    return accessToken;\n};\n\nexport default useAuth;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}